# Flask-Django-Vulnerability-Detection-Tool

A tool that performs static analysis of data and information flows in order to find vulnerabilities in a program written in Python.
The existence of a wide range of agile Web Frameworks, in this case Django or Flask, enabled the rapid development of Web Applications in the last decades.
The vulnerabilities present in their code bases could be exploited with grave consequences for users, programmers and companies/institutions. One way to avoid/mitigate the presence of these problems is by using a tool that performs static analysis on the code finding the dangerous information and data flows.

## Overview 

The tool takes in a JSON representation of an Abstract Syntax Tree (AST) and a JSON file containing the vulnerability patterns to detect. The AST is transformed into a tree-like structure using a visitor that traverses the input AST using Depth First Search. For each node, the visitor creates a node and adds it to the tree. Each node can have multiple children representing several Python code structures. Once the tree is created, the algorithm finds and reports vulnerabilities using another visitor pattern that traverses the tree and tries to find instances of the vulnerability patterns. The algorithm distinguishes between different node types and returns the resulting level from its execution, considering a dictionary structure that saves the level of the node. It also saves the sources and sanitizers that explain the current level of the node, both represented by a list. The tool also considers alternative flows in nested constructs and saves the alterations of the state of variables for each nested construct level in an alternative path.

## Example

Original code:

```
if(c>0) :
   a=b()
   if (c<3) :
      a=f(a)
   else :
      c=d(a)
e(a,c);
```

AST Input:

<details>
<summary>

```
See JSON
```

</summary>

```
{
    "ast_type": "Module",
    "body": [
        {
            "ast_type": "If",
            "body": [
                {
                    "ast_type": "Assign",
                    "col_offset": 3,
                    "end_col_offset": 8,
                    "end_lineno": 2,
                    "lineno": 2,
                    "targets": [
                        {
                            "ast_type": "Name",
                            "col_offset": 3,
                            "ctx": {
                                "ast_type": "Store"
                            },
                            "end_col_offset": 4,
                            "end_lineno": 2,
                            "id": "a",
                            "lineno": 2
                        }
                    ],
                    "type_comment": null,
                    "value": {
                        "args": [],
                        "ast_type": "Call",
                        "col_offset": 5,
                        "end_col_offset": 8,
                        "end_lineno": 2,
                        "func": {
                            "ast_type": "Name",
                            "col_offset": 5,
                            "ctx": {
                                "ast_type": "Load"
                            },
                            "end_col_offset": 6,
                            "end_lineno": 2,
                            "id": "b",
                            "lineno": 2
                        },
                        "keywords": [],
                        "lineno": 2
                    }
                },
                {
                    "ast_type": "If",
                    "body": [
                        {
                            "ast_type": "Assign",
                            "col_offset": 6,
                            "end_col_offset": 12,
                            "end_lineno": 4,
                            "lineno": 4,
                            "targets": [
                                {
                                    "ast_type": "Name",
                                    "col_offset": 6,
                                    "ctx": {
                                        "ast_type": "Store"
                                    },
                                    "end_col_offset": 7,
                                    "end_lineno": 4,
                                    "id": "a",
                                    "lineno": 4
                                }
                            ],
                            "type_comment": null,
                            "value": {
                                "args": [
                                    {
                                        "ast_type": "Name",
                                        "col_offset": 10,
                                        "ctx": {
                                            "ast_type": "Load"
                                        },
                                        "end_col_offset": 11,
                                        "end_lineno": 4,
                                        "id": "a",
                                        "lineno": 4
                                    }
                                ],
                                "ast_type": "Call",
                                "col_offset": 8,
                                "end_col_offset": 12,
                                "end_lineno": 4,
                                "func": {
                                    "ast_type": "Name",
                                    "col_offset": 8,
                                    "ctx": {
                                        "ast_type": "Load"
                                    },
                                    "end_col_offset": 9,
                                    "end_lineno": 4,
                                    "id": "f",
                                    "lineno": 4
                                },
                                "keywords": [],
                                "lineno": 4
                            }
                        }
                    ],
                    "col_offset": 3,
                    "end_col_offset": 12,
                    "end_lineno": 6,
                    "lineno": 3,
                    "orelse": [
                        {
                            "ast_type": "Assign",
                            "col_offset": 6,
                            "end_col_offset": 12,
                            "end_lineno": 6,
                            "lineno": 6,
                            "targets": [
                                {
                                    "ast_type": "Name",
                                    "col_offset": 6,
                                    "ctx": {
                                        "ast_type": "Store"
                                    },
                                    "end_col_offset": 7,
                                    "end_lineno": 6,
                                    "id": "c",
                                    "lineno": 6
                                }
                            ],
                            "type_comment": null,
                            "value": {
                                "args": [
                                    {
                                        "ast_type": "Name",
                                        "col_offset": 10,
                                        "ctx": {
                                            "ast_type": "Load"
                                        },
                                        "end_col_offset": 11,
                                        "end_lineno": 6,
                                        "id": "a",
                                        "lineno": 6
                                    }
                                ],
                                "ast_type": "Call",
                                "col_offset": 8,
                                "end_col_offset": 12,
                                "end_lineno": 6,
                                "func": {
                                    "ast_type": "Name",
                                    "col_offset": 8,
                                    "ctx": {
                                        "ast_type": "Load"
                                    },
                                    "end_col_offset": 9,
                                    "end_lineno": 6,
                                    "id": "d",
                                    "lineno": 6
                                },
                                "keywords": [],
                                "lineno": 6
                            }
                        }
                    ],
                    "test": {
                        "ast_type": "Compare",
                        "col_offset": 7,
                        "comparators": [
                            {
                                "ast_type": "Constant",
                                "col_offset": 9,
                                "end_col_offset": 10,
                                "end_lineno": 3,
                                "kind": null,
                                "lineno": 3,
                                "value": 3
                            }
                        ],
                        "end_col_offset": 10,
                        "end_lineno": 3,
                        "left": {
                            "ast_type": "Name",
                            "col_offset": 7,
                            "ctx": {
                                "ast_type": "Load"
                            },
                            "end_col_offset": 8,
                            "end_lineno": 3,
                            "id": "c",
                            "lineno": 3
                        },
                        "lineno": 3,
                        "ops": [
                            {
                                "ast_type": "Lt"
                            }
                        ]
                    }
                }
            ],
            "col_offset": 0,
            "end_col_offset": 12,
            "end_lineno": 6,
            "lineno": 1,
            "orelse": [],
            "test": {
                "ast_type": "Compare",
                "col_offset": 3,
                "comparators": [
                    {
                        "ast_type": "Constant",
                        "col_offset": 5,
                        "end_col_offset": 6,
                        "end_lineno": 1,
                        "kind": null,
                        "lineno": 1,
                        "value": 0
                    }
                ],
                "end_col_offset": 6,
                "end_lineno": 1,
                "left": {
                    "ast_type": "Name",
                    "col_offset": 3,
                    "ctx": {
                        "ast_type": "Load"
                    },
                    "end_col_offset": 4,
                    "end_lineno": 1,
                    "id": "c",
                    "lineno": 1
                },
                "lineno": 1,
                "ops": [
                    {
                        "ast_type": "Gt"
                    }
                ]
            }
        },
        {
            "ast_type": "Expr",
            "col_offset": 0,
            "end_col_offset": 6,
            "end_lineno": 7,
            "lineno": 7,
            "value": {
                "args": [
                    {
                        "ast_type": "Name",
                        "col_offset": 2,
                        "ctx": {
                            "ast_type": "Load"
                        },
                        "end_col_offset": 3,
                        "end_lineno": 7,
                        "id": "a",
                        "lineno": 7
                    },
                    {
                        "ast_type": "Name",
                        "col_offset": 4,
                        "ctx": {
                            "ast_type": "Load"
                        },
                        "end_col_offset": 5,
                        "end_lineno": 7,
                        "id": "c",
                        "lineno": 7
                    }
                ],
                "ast_type": "Call",
                "col_offset": 0,
                "end_col_offset": 6,
                "end_lineno": 7,
                "func": {
                    "ast_type": "Name",
                    "col_offset": 0,
                    "ctx": {
                        "ast_type": "Load"
                    },
                    "end_col_offset": 1,
                    "end_lineno": 7,
                    "id": "e",
                    "lineno": 7
                },
                "keywords": [],
                "lineno": 7
            }
        }
    ],
    "type_ignores": []
}

```

</details>

Patterns To Find Input:

```
[  {"vulnerability": "A",   "sources": ["f"],  "sanitizers": ["t"],   "sinks": ["e"],   "implicit": "no"},    
{"vulnerability": "B",   "sources": ["d"],     "sanitizers": [],     "sinks": ["c","e"],     "implicit": "no"}]
```

Output:

```
[{"vulnerability": "B_1", "source": "d", "sink": "c", "unsanitized flows": "yes", "sanitized flows": []}, 
{"vulnerability": "B_2", "source": "a", "sink": "e", "unsanitized flows": "yes", "sanitized flows": []}, 
{"vulnerability": "B_3", "source": "d", "sink": "e", "unsanitized flows": "yes", "sanitized flows": []}, 
{"vulnerability": "B_4", "source": "c", "sink": "e", "unsanitized flows": "yes", "sanitized flows": []}, 
{"vulnerability": "A_1", "source": "f", "sink": "e", "unsanitized flows": "yes", "sanitized flows": []}, 
{"vulnerability": "A_2", "source": "a", "sink": "e", "unsanitized flows": "yes", "sanitized flows": []}, 
{"vulnerability": "A_3", "source": "c", "sink": "e", "unsanitized flows": "yes", "sanitized flows": []}]
```

## Running The Tool

To run the tool use the command:

python bo-analyzer.py ast.json patterns.json

where ast.json is the file corresponding to the Abstract Syntax Tree of a Python code slice and patterns.json are the vulnerabilties to find in the slice.
The output of the tool should be a json file called ast.output.json, where the vulnerabilties discovered are presented.
